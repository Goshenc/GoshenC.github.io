<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Service用法示例 | GoshenC</title><meta name="author" content="GoshenC"><meta name="copyright" content="GoshenC"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ServiceService 是什么Service 是 Android 中实现程序后台运行的解决方案，它非常适合执行那些不需要和用户交互而 且还要求长期运行的任务。Service 的运行不依赖于任何用户界面，即使程序被切换到后台，或 者用户打开了另外一个应用程序，Service 仍然能够保持正常运行。 不过需要注意的是，Service 并不是运行在一个独立的进程当中的，而是依赖于创建 Servic">
<meta property="og:type" content="article">
<meta property="og:title" content="Service用法示例">
<meta property="og:url" content="http://example.com/2025/03/28/Service%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/index.html">
<meta property="og:site_name" content="GoshenC">
<meta property="og:description" content="ServiceService 是什么Service 是 Android 中实现程序后台运行的解决方案，它非常适合执行那些不需要和用户交互而 且还要求长期运行的任务。Service 的运行不依赖于任何用户界面，即使程序被切换到后台，或 者用户打开了另外一个应用程序，Service 仍然能够保持正常运行。 不过需要注意的是，Service 并不是运行在一个独立的进程当中的，而是依赖于创建 Servic">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/avatar.jpg">
<meta property="article:published_time" content="2025-03-28T09:06:26.000Z">
<meta property="article:modified_time" content="2025-03-28T09:29:50.702Z">
<meta property="article:author" content="GoshenC">
<meta property="article:tag" content="安卓知识类">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Service用法示例",
  "url": "http://example.com/2025/03/28/Service%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/",
  "image": "http://example.com/img/avatar.jpg",
  "datePublished": "2025-03-28T09:06:26.000Z",
  "dateModified": "2025-03-28T09:29:50.702Z",
  "author": [
    {
      "@type": "Person",
      "name": "GoshenC",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/circularavatar.jpg"><link rel="canonical" href="http://example.com/2025/03/28/Service%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":250,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Service用法示例',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(img/mainbackground.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">56</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/gotcha,hahaha"><span> 简体中文/Chinese-CN</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.kugou.com/"><i class="fa-fw fas fa-music"></i><span> Music(音乐)</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie(电影)</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(img/mainbackground.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/circularavatar.jpg" alt="Logo"><span class="site-name">GoshenC</span></a><a class="nav-page-title" href="/"><span class="site-name">Service用法示例</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/gotcha,hahaha"><span> 简体中文/Chinese-CN</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.kugou.com/"><i class="fa-fw fas fa-music"></i><span> Music(音乐)</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie(电影)</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Service用法示例</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-03-28T09:06:26.000Z" title="Created 2025-03-28 17:06:26">2025-03-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-03-28T09:29:50.702Z" title="Updated 2025-03-28 17:29:50">2025-03-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">5.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>19mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><h2 id="Service-是什么"><a href="#Service-是什么" class="headerlink" title="Service 是什么"></a>Service 是什么</h2><p>Service 是 Android 中实现程序后台运行的解决方案，它非常适合执行那些不需要和用户交互而 且还要求长期运行的任务。Service 的运行不依赖于任何用户界面，即使程序被切换到后台，或 者用户打开了另外一个应用程序，Service 仍然能够保持正常运行。</p>
<p>不过需要注意的是，Service 并不是运行在一个独立的进程当中的，而是依赖于创建 Service 时 所在的应用程序进程。当某个应用程序进程被杀掉时，所有依赖于该进程的 Service 也会停止运行。</p>
<p>另外，也不要被 Service 的后台概念所迷惑，实际上 Service 并不会自动开启线程，所有的代码都是默认运行在主线程当中的。也就是说，我们需要在 Service 的内部手动创建子线程，并在这里执行具体的任务，否则就有可能出现主线程被阻塞的情况。</p>
<h2 id="Android-多线程编程"><a href="#Android-多线程编程" class="headerlink" title="Android 多线程编程"></a>Android 多线程编程</h2><p>当我们需要执行一些耗时操作，比如发 起一条网络请求时，考虑到网速等其他原因，服务器未必能够立刻响应我们的请求，如果不将 这类操作放在子线程里运行，就会导致主线程被阻塞，从而影响用户对软件的正常使用。</p>
<h3 id="线程的基本用法"><a href="#线程的基本用法" class="headerlink" title="线程的基本用法"></a>线程的基本用法</h3><p>义一 个线程只需要新建一个类继承自 Thread，然后重写父类的 run () 方法，并在里面编写耗时逻辑 即可，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class MyThread : Thread()&#123;</span><br><span class="line">    override fun run()&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么该如何启动这个线程呢？其实很简单，只需要创建 MyThread 的实例，然后调用它的 start () 方法即可，这样 run () 方法中的代码就会在子线程当中运行了，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyThread().start()</span><br></pre></td></tr></table></figure>

<p>当然，使用继承的方式耦合性有点高，我们会更多地选择使用实现 Runnable 接口的方式来定义 一个线程，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class MyThread : Runnable &#123; </span><br><span class="line">     override fun run() &#123; </span><br><span class="line">        // 编写具体的逻辑 </span><br><span class="line">     &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果使用了这种写法，启动线程的方法也需要进行相应的改变，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val myThread = MyThread() </span><br><span class="line">Thread(myThread).start() </span><br></pre></td></tr></table></figure>

<p>可以看到，Thread 的构造函数接收一个 Runnable 参数，而我们创建的 MyThread 实例正是一 个实现了 Runnable 接口的对象，所以可以直接将它传入 Thread 的构造函数里。接着调用 Thread 的 start () 方法，run () 方法中的代码就会在子线程当中运行了。</p>
<p>当然，如果你不想专门再定义一个类去实现 Runnable 接口，也可以使用 Lambda 的方式，这种 写法更为常见，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread &#123; </span><br><span class="line"> // 编写具体的逻辑 </span><br><span class="line">&#125;.start()</span><br></pre></td></tr></table></figure>

<p>以上几种线程的使用方式你应该不会感到陌生，因为在 Java 中创建和启动线程也是使用同样的 方式。而 Kotlin 还给我们提供了一种更加简单的开启线程的方式，写法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">thread &#123; </span><br><span class="line"> // 编写具体的逻辑 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 thread 是一个 Kotlin 内置的顶层函数，我们只需要在 Lambda 表达式中编写具体的逻辑 就可以了，连 start () 方法都不用调用，thread 函数在内部帮我们全部都处理好了。</p>
<h3 id="在子线程中更新-UI"><a href="#在子线程中更新-UI" class="headerlink" title="在子线程中更新 UI"></a>在子线程中更新 UI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class MainActivity : AppCompatActivity()&#123;</span><br><span class="line">    val updateText = 1</span><br><span class="line">    lateinit var textView : TextView</span><br><span class="line">    </span><br><span class="line">    val handle = object : Handler(Looper.getMainLooper())&#123;</span><br><span class="line">        override fun handleMessage(msg:Message)&#123;</span><br><span class="line">            when(msg.what)&#123;</span><br><span class="line">                updateText -&gt; textView.text = &quot;Nice to meet you&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override fun onCreate(savedInstanceState : Bundle?)&#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        val binding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        textView = binding.textView</span><br><span class="line">        val changeTextBtn = binding.changeTextBtn</span><br><span class="line">        changeTextBtn.setOnClickListener&#123;</span><br><span class="line">            thread&#123;</span><br><span class="line">                val msg = Message()</span><br><span class="line">                mag.what = updateText</span><br><span class="line">                handle.sendMessage(msg)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解析异步消息处理机制"><a href="#解析异步消息处理机制" class="headerlink" title="解析异步消息处理机制"></a>解析异步消息处理机制</h3><p>Android 中的异步消息处理主要由 4 个部分组成：Message、Handler、MessageQueue 和 Looper。</p>
<ul>
<li><p>Message</p>
<p>Message 是在线程之间传递的消息，它可以在内部携带少量的消息，用于在不同线程之间传递数据。</p>
</li>
<li><p>Handler</p>
<p>Handler 主要是用于发送和处理消息的，发出的消息经过一系列地辗转处理后，最终会传递到 Handler 的 handleMessage () 方法中</p>
</li>
<li><p>MessageQueue</p>
<p>MessageQueue 是消息队列的意思，它主要用于存放所有通过 Handler 发送的消息。这部分消息会一直存在于消息队列中，等待被处理。每个线程中只有一个 MessageQueue 对象。</p>
</li>
<li><p>Looper</p>
<p>Looper 是每个线程中的 MessageQueue 的管家，调用 Looper 的 loop () 方法后，就会进入一个无限循环当中，然后每当发现 MessageQueue 中存在一条消息时，就会将它取出，并传递到 Handler 的 handleMessage () 方法中。每个线程中只会有一个 Looper 对象</p>
</li>
</ul>
<h4 id="异步消息处理流程"><a href="#异步消息处理流程" class="headerlink" title="异步消息处理流程"></a>异步消息处理流程</h4><p>首先需要在主线程当中创建一个 Handler 对象，并重写 handleMessage () 方法。然后当子线程中国需要进行 UI 操作时，就创建一个 Message 对象，并通过 Handler 将这条消息发送出去。之后这条消息就会被添加到 MessageQueue 的队列中等待被处理，而 Looper 则会一直尝试从 MessageQueue 中取出待处理消息，最后分发回 Handler 的 handleMessage () 方法中。由于 Handle 的构造函数中我们传入了 Looper.getMainLooper ()，所以此时 handleMessage () 方法中的代码也会在主线程中运行</p>
<h3 id="使用-AsyncTask"><a href="#使用-AsyncTask" class="headerlink" title="使用 AsyncTask"></a>使用 AsyncTask</h3><p>首先来看一下 AsyncTask 的基本用法。由于 AsyncTask 是一个抽象类，所以如果我们想使用 它，就必须创建一个子类去继承它。在继承时我们可以为 AsyncTask 类指定 3 个泛型参数，这 3 个参数的用途如下。</p>
<ul>
<li>Params。在执行 AsyncTask 时需要传入的参数，可用于在后台任务中使用。</li>
<li>Progress。在后台任务执行时，如果需要在界面上显示当前的进度，则使用这里指定的泛型作为单位进度</li>
<li>Result。当任务执行完毕后，如果需要对结果进行返回，则使用这里指定的泛型作为返回值类型</li>
</ul>
<p>因此，一个最简单的自定义 AsyncTask 就可以写成如下形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class DownloadTask : AsyncTask&lt;Unit, Int, Boolean&gt;() &#123; </span><br><span class="line"> 	... </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>这里我们把 AsyncTask 的第一个泛型参数指定为 Unit，表示在执行 AsyncTask 的时候不需要传 入参数给后台任务。第二个泛型参数指定为 Int，表示使用整型数据来作为进度显示单位。第三 个泛型参数指定为 Boolean，则表示使用布尔型数据来反馈执行结果。</p>
<p>当然，目前我们自定义的 DownloadTask 还是一个空任务，并不能进行任何实际的操作，我们 还需要重写 AsyncTask 中的几个方法才能完成对任务的定制。经常需要重写的方法有以下 4 个。</p>
<ul>
<li><p>onPreExecute()</p>
<p>这个方法回在后台任务开始执行之前调用，用于进行一些界面上的初始化操作，比如显示一个进度条对话框等</p>
</li>
<li><p>doInBackground(Params…)</p>
<p>这个方法中的所有代码都会在子线程中运行，我们应该在这里去处理所有的耗时任务。任务一旦完成，就可以通过 return 语句将任务的执行结果返回，如果 AsyncTask 的第三个泛型参数指定的是 Unit，就可以不返回任务执行的结果注意，在这个方法中是不可以进行 UI 操作的，如果需要更新 UI 元素，比如说反馈当前任务的执行进度，可以调用 publishProgress (Progress…) 方法来完成。</p>
</li>
<li><p>onProgressUpdate(Progress…)</p>
<p>当在后台任务中调用了 publishProgress (Progress…) 方法后， onProgressUpdate (Progress…) 方法就会很快被调用，该方法中携带的参数就是 在后台任务中传递过来的。在这个方法中可以对 UI 进行操作，利用参数中的数值就可以对 界面元素进行相应的更新。</p>
</li>
<li><p>onPostExecute(Result)</p>
<p>当后台任务执行完毕并通过 return 语句进行返回时，这个方法就很快会被调用。返回的数 据会作为参数传递到此方法中，可以利用返回的数据进行一些 UI 操作，比如说提醒任务执 行的结果，以及关闭进度条对话框等。</p>
</li>
</ul>
<h2 id="Service-的基本用法"><a href="#Service-的基本用法" class="headerlink" title="Service 的基本用法"></a>Service 的基本用法</h2><h3 id="定义一个-Service"><a href="#定义一个-Service" class="headerlink" title="定义一个 Service"></a>定义一个 Service</h3><p>首先看一下如何在项目中定义一个 Service。新建一个 ServiceTest 项目，然后右击 com.example.servicetest→New→Service→Service，</p>
<p>可以看到，这里我们将类名定义成 MyService，Exported 属性表示是否将这个 Service 暴露给 外部其他程序访问，Enabled 属性表示是否启用这个 Service。将两个属性都勾中，点 击 “Finish” 完成创建。</p>
<p>现在观察 MyService 中的代码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class MyService : Service() &#123; </span><br><span class="line"> </span><br><span class="line"> override fun onBind(intent: Intent): IBinder &#123; </span><br><span class="line">     TODO(&quot;Return the communication channel to the service.&quot;) </span><br><span class="line">     &#125; </span><br><span class="line"> </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>可以看到，MyService 是继承自系统的 Service 类的。目前 MyService 中可以算是空空如也， 但有一个 onBind () 方法特别醒目。这个方法是 Service 中唯一的抽象方法，所以必须在子类里 实现。我们会在后面的小节中使用到 onBind () 方法，目前可以暂时将它忽略。 既然是定义一个 Service，自然应该在 Service 中处理一些事情了，那处理事情的逻辑应该写在 哪里呢？这时就可以重写 Service 中的另外一些方法了，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class MyService : Service() &#123; </span><br><span class="line"> ... </span><br><span class="line"> override fun onCreate() &#123; </span><br><span class="line"> super.onCreate() </span><br><span class="line"> &#125; </span><br><span class="line"> </span><br><span class="line"> override fun onStartCommand(intent: Intent, flags: Int, startId: Int): Int &#123; </span><br><span class="line"> return super.onStartCommand(intent, flags, startId) </span><br><span class="line"> &#125; </span><br><span class="line"> </span><br><span class="line"> override fun onDestroy() &#123; </span><br><span class="line"> super.onDestroy() </span><br><span class="line"> &#125; </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，这里我们又重写了 onCreate ()、onStartCommand () 和 onDestroy () 这 3 个方 法，它们是每个 Service 中最常用到的 3 个方法了。其中 onCreate () 方法会在 Service 创建的 时候调用，onStartCommand () 方法会在每次 Service 启动的时候调用，onDestroy () 方法 会在 Service 销毁的时候调用。</p>
<p>通常情况下，如果我们希望 Service 一旦启动就立刻去执行某个动作，就可以将逻辑写在 onStartCommand () 方法里。而当 Service 销毁时，我们又应该在 onDestroy () 方法中回收 那些不再使用的资源。</p>
<h3 id="启动和停止-Service"><a href="#启动和停止-Service" class="headerlink" title="启动和停止 Service"></a>启动和停止 Service</h3><p>定义好了 Service 之后，接下来就应该考虑如何启动以及停止这个 Service。启动和停止的方法 当然你也不会陌生，主要是借助 Intent 来实现的。下面就让我们在 ServiceTest 项目中尝试启动 以及停止 MyService。</p>
<p>修改 MainActivity 中的代码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class MainActivity : AppCompatActivity()&#123;</span><br><span class="line">    override fun onCreate(savedInstanceState : Bundle?)&#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        val binding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        val startServiceBtn = binding.startServiceBtn</span><br><span class="line">        val stopServiceBtn = binding.stopServiceBtn</span><br><span class="line">        startServiceBtn.setOnClickListener&#123;</span><br><span class="line">            val intent = Intent(this,MyService::class.java)</span><br><span class="line">            startService(intent)</span><br><span class="line">        &#125;</span><br><span class="line">        stioServiceBtn.setOnCLickListener&#123;</span><br><span class="line">            val intent = Intent(this,Myservice::class.java)</span><br><span class="line">            stopService(intent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OnCreate-方法和-onStartCommand-方法区别"><a href="#OnCreate-方法和-onStartCommand-方法区别" class="headerlink" title="OnCreate () 方法和 onStartCommand () 方法区别"></a>OnCreate () 方法和 onStartCommand () 方法区别</h4><p>onCreate () 方法是在 Service 第一次创建的时候调用的，而 onStartCommand () 方法则 在每次启动 Service 的时候都会调用。由于刚才我们是第一次点击 “Start Service” 按钮， Service 此时还未创建过，所以两个方法都会执行，之后如果你再连续多点击几次 “Start Service” 按钮，你就会发现只有 onStartCommand () 方法可以得到执行了。</p>
<h3 id="Activity-和-Service-进行通信"><a href="#Activity-和-Service-进行通信" class="headerlink" title="Activity 和 Service 进行通信"></a>Activity 和 Service 进行通信</h3><p>使用 onBind () 方法</p>
<p>比如说，目前我们希望在 MyService 里提供一个下载功能，然后在 Activity 中可以决定何时开始 下载，以及随时查看下载进度。实现这个功能的思路是创建一个专门的 Binder 对象来对下载功 能进行管理。修改 MyService 中的代码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class MyService : Service() &#123;</span><br><span class="line">    private val mBinder = DownloadBinder()</span><br><span class="line">    </span><br><span class="line">    class DownloadBinder : Binder()&#123;</span><br><span class="line">        </span><br><span class="line">        fun startDownload()&#123;</span><br><span class="line">            Log.d(&quot;MyService&quot;,&quot;startDownload executed&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        fun getProgress() : Int &#123;</span><br><span class="line">            Log.d(&quot;MyService&quot;,&quot;getProgress executed&quot;)</span><br><span class="line">            return 0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override fun onBind(intent:Intent) : IBinder&#123;</span><br><span class="line">        return mBinder</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，这里我们新建了一个 DownloadBinder 类，并让它继承自 Binder，然后在它的内 部提供了开始下载以及查看下载进度的方法。当然这只是两个模拟方法，并没有实现真正的功 能，我们在这两个方法中分别打印了一行日志。</p>
<p>接着，在 MyService 中创建了 DownloadBinder 的实例，然后在 onBind () 方法里返回了这个 实例，这样 MyService 中的工作就全部完成了。</p>
<p>下面就要看一看在 Activity 中如何调用 Service 里的这些方法了。首先需要在布局文件里新增两 个按钮，修改 activity_main.xml 中的代码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; </span><br><span class="line">     android:orientation=&quot;vertical&quot; </span><br><span class="line">     android:layout_width=&quot;match_parent&quot; </span><br><span class="line">     android:layout_height=&quot;match_parent&quot;&gt; </span><br><span class="line"></span><br><span class="line">         ... </span><br><span class="line"></span><br><span class="line">             &lt;Button </span><br><span class="line">                 android:id=&quot;@+id/bindServiceBtn&quot; </span><br><span class="line">                 android:layout_width=&quot;match_parent&quot; </span><br><span class="line">                 android:layout_height=&quot;wrap_content&quot; </span><br><span class="line">                 android:text=&quot;Bind Service&quot; /&gt; </span><br><span class="line"></span><br><span class="line">             &lt;Button </span><br><span class="line">                 android:id=&quot;@+id/unbindServiceBtn&quot; </span><br><span class="line">                 android:layout_width=&quot;match_parent&quot; </span><br><span class="line">                 android:layout_height=&quot;wrap_content&quot; </span><br><span class="line">                 android:text=&quot;Unbind Service&quot; /&gt; </span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>这两个按钮分别是用于绑定和取消绑定 Service 的，那到底谁需要和 Service 绑定呢？当然就是 Activity 了。当一个 Activity 和 Service 绑定了之后，就可以调用该 Service 里的 Binder 提供的 方法了。修改 MainActivity 中的代码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class MainActivity : AppCompatActivity()&#123;</span><br><span class="line">    lateinit var downloadBinder : MyService.DownloadBinder</span><br><span class="line">    </span><br><span class="line">    private val connection = object : ServiceConnection&#123;</span><br><span class="line">        override fun onServiceConnected(name:ComponentName,service:IBinder)&#123;</span><br><span class="line">            downloadBinder = service as MyService.DownloadBinder</span><br><span class="line">            downloadBinder.startDownload()</span><br><span class="line">            downloadBinder.getProgress()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        override fun onServiceDisconnected(name : ComponentName)&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?)&#123;</span><br><span class="line">        、、、</span><br><span class="line">        bindServiceBtn.setOnClickListener&#123;</span><br><span class="line">            val intent = Intent(this, MyService::class.java)</span><br><span class="line">            bindService(intent,connection,Context.BIND_AUTO_CREATE)</span><br><span class="line">        &#125;</span><br><span class="line">        unbindServiceBtn.setOnClickListener&#123;</span><br><span class="line">            unbindService(connection)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Service-的生命周期"><a href="#Service-的生命周期" class="headerlink" title="Service 的生命周期"></a>Service 的生命周期</h2><p>一旦在项目的任何位置调用了 Context 的 startService() 方法，相应的 Service 就会启动， 并回调 onStartCommand () 方法。如果这个 Service 之前还没有创建过，onCreate () 方法会 先于 onStartCommand () 方法执行。Service 启动了之后会一直保持运行状态，直到 stopService() 或 stopSelf () 方法被调用，或者被系统回收。注意，虽然每调用一次 startService() 方法，onStartCommand () 就会执行一次，但实际上每个 Service 只会存在 一个实例。所以不管你调用了多少次 startService() 方法，只需调用一次 stopService() 或 stopSelf () 方法，Service 就会停止。 另外，还可以调用 Context 的 bindService() 来获取一个 Service 的持久连接，这时就会回调 Service 中的 onBind () 方法。类似地，如果这个 Service 之前还没有创建过，onCreate () 方 法会先于 onBind () 方法执行。之后，调用方可以获取到 onBind () 方法里返回的 IBinder 对象 的实例，这样就能自由地和 Service 进行通信了。只要调用方和 Service 之间的连接没有断开， Service 就会一直保持运行状态，直到被系统回收。 当调用了 startService() 方法后，再去调用 stopService() 方法。这时 Service 中的 onDestroy () 方法就会执行，表示 Service 已经销毁了。类似地，当调用了 bindService() 方法后，再去调用 unbindService() 方法，onDestroy () 方法也会执行，这两种情况都很好 理解。但是需要注意，我们是完全有可能对一个 Service 既调用了 startService() 方法，又 调用了 bindService() 方法的，在这种情况下该如何让 Service 销毁呢？根据 Android 系统的 机制，一个 Service 只要被启动或者被绑定了之后，就会处于运行状态，必须要让以上两种条件 同时不满足，Service 才能被销毁。所以，这种情况下要同时调用 stopService() 和 unbindService() 方法，onDestroy () 方法才会执行。 这样你就把 Service 的生命周期完整地走了一遍。</p>
<h2 id="Service-的更多技巧"><a href="#Service-的更多技巧" class="headerlink" title="Service 的更多技巧"></a>Service 的更多技巧</h2><h3 id="使用前台-Service"><a href="#使用前台-Service" class="headerlink" title="使用前台 Service"></a>使用前台 Service</h3><p>修改 MyService 中的代 码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class MyService : Service()&#123;</span><br><span class="line">    、、、</span><br><span class="line">    override fun onCreate()&#123;</span><br><span class="line">        super.onCreate()</span><br><span class="line">        Log.d(&quot;MyService&quot;,&quot;onCreate executed&quot;)</span><br><span class="line">        val manager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager</span><br><span class="line">        if(Build.VERSION.SDK_INT &gt;= Build&gt;VERSION_CODES.0)&#123;</span><br><span class="line">            val channel = NotoficationManager(&quot;my_service&quot;,&quot;前台Service通知&quot;,NotificationManager.IMPORTANCE_DEFAULT)</span><br><span class="line">            	manager.createNotificationChannel(channel)</span><br><span class="line">        &#125;</span><br><span class="line">        val intent = Intent(this, MainActivity::class.java)</span><br><span class="line">        val pi = PendingIntent.getActivity(this,0,intent,0)</span><br><span class="line">        val notification = NotificationCompat.Builder(this,&quot;my_service&quot;)</span><br><span class="line">        	.setContextTitle(&quot;This is content text&quot;)</span><br><span class="line">        	.setSmallIcon(R.drawable.small_icon)</span><br><span class="line">        	.setLargeIcon(BitmapFactory.decodeResource(resoruces,R.drabable.large_icon))</span><br><span class="line">        	.setContentIntent(pi)</span><br><span class="line">        	.build()</span><br><span class="line">        startForeground(1,notification)  	</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用 startForeground () 方法后就会让 MyService 变成一个前 台 Service，并在系统状态栏显示出来。</p>
<p>另外，从 Android 9.0 系统开始，使用前台 Service 必须在 AndroidManifest.xml 文件中进行权 限声明才行，而且如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; </span><br><span class="line"> package=&quot;com.example.servicetest&quot;&gt; </span><br><span class="line">     &lt;uses-permission android:name=&quot;android.permission.FOREGROUND_SERVICE&quot; /&gt;添加这个</span><br><span class="line">     &lt;uses-permission android:name=&quot;android.permission.FOREGROUND_SERVICE_DATA_SYNC&quot;/&gt;/*添加这个，对应android:foregroundServiceType=&quot;dataSync&quot;所需要的权限*/</span><br><span class="line">         ... </span><br><span class="line">        &lt;service</span><br><span class="line">            android:name=&quot;.MyService&quot;</span><br><span class="line">            android:enabled=&quot;true&quot;</span><br><span class="line">            android:exported=&quot;false&quot;</span><br><span class="line">            android:foregroundServiceType=&quot;dataSync&quot;/&gt;/*添加这个属性，前台service一定要的，也可以是mediaPlayback等，但要添加相应的权限*/</span><br><span class="line">            ...</span><br><span class="line">&lt;/manifest&gt; </span><br></pre></td></tr></table></figure>

<p>现在即使你退出应用程序，MyService 也会一直处于运行状态，而且不用担心会被系统回收。 当然，MyService 所对应的通知也会一直显示在状态栏上面。如果用户不希望我们的程序一直 运行，也可以选择手动杀掉应用，这样 MyService 就会跟着一起停止运行了。</p>
<h3 id="使用-IntentService"><a href="#使用-IntentService" class="headerlink" title="使用 IntentService"></a>使用 IntentService</h3><p>Android 专门提供了一个 IntentService 类，这个类就很好地解决了前面所提到的两种尴尬，下面我们就来看一下它的用法。</p>
<p>新建一个 MyIntentService 类继承自 IntentService，代码如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class MyIntentService : IntentService(&quot;MyIntentService&quot;)&#123;</span><br><span class="line">    override fun onHandleIntent(intent:Intent?)&#123;</span><br><span class="line">        //打印当前线程的id</span><br><span class="line">        Log.d(&quot;MyIntentService&quot;, &quot;Thread id is $&#123;Thread.currentThread().name&#125;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override fun onDestroy()&#123;</span><br><span class="line">        super.onDestroy()</span><br><span class="line">        Log.d(&quot;MyIntentService&quot;,&quot;onDestroy executed&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来修改 activity_main.xml 中的代码，加入一个用于启动 MyIntentService 的按钮，如下 所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; </span><br><span class="line"> android:orientation=&quot;vertical&quot; </span><br><span class="line"> android:layout_width=&quot;match_parent&quot; </span><br><span class="line"> android:layout_height=&quot;match_parent&quot;&gt; </span><br><span class="line"> </span><br><span class="line">     ... </span><br><span class="line"></span><br><span class="line">     &lt;Button </span><br><span class="line">         android:id=&quot;@+id/startIntentServiceBtn&quot; </span><br><span class="line">         android:layout_width=&quot;match_parent&quot; </span><br><span class="line">         android:layout_height=&quot;wrap_content&quot; </span><br><span class="line">         android:text=&quot;Start IntentService&quot; /&gt; </span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt; </span><br></pre></td></tr></table></figure>

<p>然后修改 MainActivity 中的代码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class MainActivity : AppCompatActivity()&#123;</span><br><span class="line">    、、、</span><br><span class="line">    override fun onCreate(savedInstanceState:Bundle?)&#123;</span><br><span class="line">        、、、</span><br><span class="line">        startIntentServiceBtn.setOnClickListener&#123;</span><br><span class="line">            //打印主线程的id</span><br><span class="line">            Log.d(&quot;MainActivity&quot;,&quot;Thread id is $&#123;Thread.currentThread().name&#125;&quot;)</span><br><span class="line">            val intent = Intent(this,MyIntentService::class.java)</span><br><span class="line">            startService(intent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，我们在 “Start IntentService” 按钮的点击事件里启动了 MyIntentService，并在这 里打印了一下主线程名，稍后用于和 IntentService 进行比对。你会发现，其实 IntentService 的启动方式和普通的 Service 没什么两样</p>
<p>最后不要忘记，Service 都是需要在 AndroidManifest.xml 里注册的，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">、、、</span><br><span class="line">&lt;service</span><br><span class="line">         android:name=&quot;MyIntentService&quot;</span><br><span class="line">         android:enabled=&quot;true&quot;</span><br><span class="line">         android:exported=&quot;true&quot;</span><br><span class="line">         /&gt;</span><br><span class="line">、、、</span><br></pre></td></tr></table></figure>

<h2 id="Kotlin-课堂：泛型的高级特性"><a href="#Kotlin-课堂：泛型的高级特性" class="headerlink" title="Kotlin 课堂：泛型的高级特性"></a>Kotlin 课堂：泛型的高级特性</h2><h3 id="对泛型进行实化"><a href="#对泛型进行实化" class="headerlink" title="对泛型进行实化"></a>对泛型进行实化</h3><p>那么具体该怎么写才能将泛型实化呢？首先，该函数必须是内联函数才行，也就是要用 inline 关键字来修饰该函数。其次，在声明泛型的地方必须加上 reified 关键字来表示该泛型要进行 实化。示例代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inline fun &lt;reified T&gt; getGenericType() &#123; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述函数中的泛型 T 就是一个被实化的泛型，因为它满足了内联函数和 reified 关键字这两个前 提条件。那么借助泛型实化，到底可以实现什么样的效果呢？从函数名就可以看出来了，这里 我们准备实现一个获取泛型实际类型的功能，代码如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inline fun &lt;reified T&gt; getGenericType() = T::class.java </span><br></pre></td></tr></table></figure>

<p>虽然只有一行代码，但是这里却实现了一个 Java 中完全不可能实现的功能： getGenericType () 函数直接返回了当前指定泛型的实际类型。T.class 这样的语法在 Java 中是不合法的，而在 Kotlin 中，借助泛型实化功能就可以使用 T::class.java 这样的语法了</p>
<p>现在我们可以使用如下代码对 getGenericType () 函数进行测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fun main() &#123; </span><br><span class="line">     val result1 = getGenericType&lt;String&gt;() </span><br><span class="line">     val result2 = getGenericType&lt;Int&gt;() </span><br><span class="line">     println(&quot;result1 is $result1&quot;) </span><br><span class="line">     println(&quot;result2 is $result2&quot;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型实化的应用"><a href="#泛型实化的应用" class="headerlink" title="泛型实化的应用"></a>泛型实化的应用</h3><p>新建一个 reiﬁed.kt 文件，然后在里面编写如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">inline fun &lt;reified T&gt; startActivity(context: Context) &#123; </span><br><span class="line">     val intent = Intent(context, T::class.java) </span><br><span class="line">     context.startActivity(intent) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们定义了一个 startActivity () 函数，该函数接收一个 Context 参数，并同时使用 inline 和 reified 关键字让泛型 T 成为了一个被实化的泛型。接下来就是神奇的地方了， Intent 接收的第二个参数本来应该是一个具体 Activity 的 Class 类型，但由于现在 T 已经是一个 被实化的泛型了，因此这里我们可以直接传入 T::class.java。最后调用 Context 的 startActivity () 方法来完成 Activity 的启动</p>
<p>现在，如果我们想要启动 TestActivity，只需要这样写就可以了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startActivity&lt;TestActivity&gt;(context) </span><br></pre></td></tr></table></figure>

<p>添加一个新的 startActivity () 函数重载，如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inline fun &lt;reified T&gt; startActivity(context: Context, block: Intent.() -&gt; Unit) &#123; </span><br><span class="line">     val intent = Intent(context, T::class.java) </span><br><span class="line">     intent.block() </span><br><span class="line">     context.startActivity(intent) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>可以看到，这次的 startActivity () 函数中增加了一个函数类型参数，并且它的函数类型是 定义在 Intent 类当中的。在创建完 Intent 的实例之后，随即调用该函数类型参数，并把 Intent 的 实例传入，这样调用 startActivity () 函数的时候就可以在 Lambda 表达式中为 Intent 传递 参数了，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">startActivity&lt;TestActivity&gt;(context) &#123; </span><br><span class="line">     putExtra(&quot;param1&quot;, &quot;data&quot;) </span><br><span class="line">     putExtra(&quot;param2&quot;, 123) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">GoshenC</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2025/03/28/Service%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/">http://example.com/2025/03/28/Service%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%89%E5%8D%93%E7%9F%A5%E8%AF%86%E7%B1%BB/">安卓知识类</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/28/WorkManager%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/" title="WorkManager用法示例"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">WorkManager用法示例</div></div><div class="info-2"><div class="info-item-1">WorkManager 是什么？WorkManager 是 Android 用来执行后台任务的工具，适用于：  执行一次的任务（比如：上传日志、备份数据）。 定期执行的任务（比如：每 15 分钟同步数据）。 即使应用关闭、设备重启后也能执行的任务。   1. 引入 WorkManager先在 build.gradle.kts（模块级）中添加依赖：	 123dependencies &#123;    implementation(&quot;androidx.work:work-runtime-ktx:2.9.0&quot;) // WorkManager 最新版&#125;  然后 同步 Gradle（点击“Sync Now”）。  2. 创建 WorkerWorker 是 WorkManager 执行任务的地方。我们需要创建一个类，继承 Worker 或 CoroutineWorker（推荐）。 简单任务示例新建一个 MyWorker.kt： 12345678910111213import android.content.Contextimport...</div></div></div></a><a class="pagination-related" href="/2025/03/29/HttpURLConnection%E7%9A%84%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/" title="HttpURLConnection的用法示例"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">HttpURLConnection的用法示例</div></div><div class="info-2"><div class="info-item-1">HttpURLConnection 是 Android 进行网络请求的一个轻量级 HTTP 客户端，适用于简单的 GET 和 POST 请求。以下是 HttpURLConnection 的基本使用方法。  使用步骤 创建 URL 对象 打开连接并配置请求 发送请求 读取响应 关闭连接   示例代码1. GET 请求123456789101112131415161718192021222324252627import java.net.HttpURLConnectionimport java.net.URLfun sendGetRequest(urlString: String): String? &#123;    var connection: HttpURLConnection? = null    try &#123;        val url = URL(urlString)        connection = url.openConnection() as HttpURLConnection        connection.requestMethod =...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/14/Retrofit%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B/" title="Retrofit用法示例"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-14</div><div class="info-item-2">Retrofit用法示例</div></div><div class="info-2"><div class="info-item-1">Retrofit 使用指南 Retrofit 是 Android 上最常用的网络请求库之一，它简化了 HTTP 请求的处理，支持 GET、POST、PUT、DELETE 等请求方式，并且可以配合 Gson、Moshi 等解析 JSON 数据。 1. 添加依赖在 build.gradle (Module 级) 中添加： 1234dependencies &#123;    implementation &#x27;com.squareup.retrofit2:retrofit:2.9.0&#x27;    implementation &#x27;com.squareup.retrofit2:converter-gson:2.9.0&#x27; // Gson 解析 JSON&#125;  2. 创建 API 接口定义 API 接口，例如获取用户信息： 12345678910111213141516171819202122232425import retrofit2.Callimport retrofit2.http.GETimport...</div></div></div></a><a class="pagination-related" href="/2025/03/14/startActivity%E5%92%8CregisterForActivityResult%E7%9A%84%E7%94%A8%E6%B3%95/" title="startActivity和registerForActivityResult的用法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-14</div><div class="info-item-2">startActivity和registerForActivityResult的用法</div></div><div class="info-2"><div class="info-item-1">在 Android Kotlin 开发中，startActivity 和 registerForActivityResult 是启动新 Activity 并处理返回结果的两种方式。  1. 使用 startActivitystartActivity 适用于 不需要获取返回值 的情况，例如从 MainActivity 跳转到 SecondActivity： 示例：启动新 Activity12val intent = Intent(this, SecondActivity::class.java)startActivity(intent)  如果你需要传递数据： 1234val intent = Intent(this, SecondActivity::class.java).apply &#123;    putExtra(&quot;key&quot;, &quot;Hello, SecondActivity!&quot;)&#125;startActivity(intent)  在 SecondActivity 中获取： 1val data =...</div></div></div></a><a class="pagination-related" href="/2025/03/15/Room%E7%94%A8%E6%B3%95/" title="Room用法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-15</div><div class="info-item-2">Room用法</div></div><div class="info-2"><div class="info-item-1">Room 是 Android 官方推荐的数据库框架，它是 SQLite 的抽象封装，提供了更便捷的数据库操作方式，支持 Kotlin 协程和 LiveData。以下是 Room 的基本使用方法：  1. 添加 Room 依赖在 build.gradle.kts（模块级）中添加 Room 相关依赖： 12345678dependencies &#123;    val room_version = &quot;2.6.1&quot; // 确保使用最新版本    implementation(&quot;androidx.room:room-runtime:$room_version&quot;)    kapt(&quot;androidx.room:room-compiler:$room_version&quot;) // 用于注解处理器    implementation(&quot;androidx.room:room-ktx:$room_version&quot;) // 支持 Kotlin 协程&#125;  如果项目使用 Kotlin Symbol...</div></div></div></a><a class="pagination-related" href="/2025/03/15/ViewModel%E7%94%A8%E6%B3%95/" title="ViewModel用法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-15</div><div class="info-item-2">ViewModel用法</div></div><div class="info-2"><div class="info-item-1">ViewModel 是 Android 架构组件之一，用于管理 UI 相关的数据，并在 配置更改（如屏幕旋转）时保持数据不丢失。  🔹 1. 添加 ViewModel 依赖在 build.gradle.kts（模块级）中添加： 123dependencies &#123;    implementation(&quot;androidx.lifecycle:lifecycle-viewmodel-ktx:2.6.2&quot;)&#125;   🔹 2. 创建 ViewModel（1）基础 ViewModel123456789import androidx.lifecycle.ViewModelclass CounterViewModel : ViewModel() &#123;    var count = 0 // ViewModel 变量（Activity 重建后不会丢失）    fun increment() &#123;        count++    &#125;&#125;   🔹 3. 在 Activity&#x2F;Fragment...</div></div></div></a><a class="pagination-related" href="/2025/03/15/Room-ViewModel-LiveData%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%E7%9A%84%E7%94%A8%E6%B3%95/" title="Room+ViewModel+LiveData一起使用的用法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-15</div><div class="info-item-2">Room+ViewModel+LiveData一起使用的用法</div></div><div class="info-2"><div class="info-item-1">在 Android 开发中，Room、ViewModel 和 LiveData 经常一起使用，以实现 MVVM 架构，并提供持久化数据存储、生命周期感知的数据管理和自动更新 UI 的能力。  📌 1. 主要作用   组件 作用    Room（数据库） 提供 SQLite 的抽象层，管理本地数据存储   ViewModel 管理 UI 相关的数据，确保数据在配置变更（如旋转屏幕）时不会丢失   LiveData 观察数据变化，并在 UI 组件生命周期内自动更新    🚀 2. 使用 Room + ViewModel + LiveData 的完整示例📌 功能：我们实现一个简单的待办事项（ToDo List）应用，可以：  增删查改任务，数据存储在 Room 数据库中。 使用 LiveData 让 UI 自动更新，而不需要手动刷新。 ViewModel 负责管理数据，避免 Activity 直接操作数据库。   📌 3. 创建 Room 数据库（1）定义 Entity（数据库表）123456789import androidx.room.Entityimport...</div></div></div></a><a class="pagination-related" href="/2025/03/15/SQLite%E7%94%A8%E6%B3%95/" title="SQLite用法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-15</div><div class="info-item-2">SQLite用法</div></div><div class="info-2"><div class="info-item-1">SQLite 是一种轻量级的嵌入式数据库，在 Android 中用于存储结构化数据。你可以通过 SQLiteOpenHelper 来管理数据库的创建、升级、和版本管理。以下是使用 SQLite 的基本步骤： 1. 创建数据库和表使用 SQLiteOpenHelper 创建数据库以及表结构。这个类会帮助你创建数据库、执行表的升级、降级等操作。 创建 SQLiteOpenHelper 类123456789101112131415161718192021222324252627282930import android.content.Contextimport android.database.sqlite.SQLiteDatabaseimport android.database.sqlite.SQLiteOpenHelperclass MyDatabaseHelper(context: Context) : SQLiteOpenHelper(context, DATABASE_NAME, null, DATABASE_VERSION) &#123;    companion...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">GoshenC</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">56</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Goshenc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Goshenc" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:gx.c221434@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Welcome</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Service"><span class="toc-number">1.</span> <span class="toc-text">Service</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Service-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.</span> <span class="toc-text">Service 是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">Android 多线程编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.2.1.</span> <span class="toc-text">线程的基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%AD%90%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%9B%B4%E6%96%B0-UI"><span class="toc-number">1.2.2.</span> <span class="toc-text">在子线程中更新 UI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">解析异步消息处理机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">异步消息处理流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-AsyncTask"><span class="toc-number">1.2.4.</span> <span class="toc-text">使用 AsyncTask</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">Service 的基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA-Service"><span class="toc-number">1.3.1.</span> <span class="toc-text">定义一个 Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%92%8C%E5%81%9C%E6%AD%A2-Service"><span class="toc-number">1.3.2.</span> <span class="toc-text">启动和停止 Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OnCreate-%E6%96%B9%E6%B3%95%E5%92%8C-onStartCommand-%E6%96%B9%E6%B3%95%E5%8C%BA%E5%88%AB"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">OnCreate () 方法和 onStartCommand () 方法区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity-%E5%92%8C-Service-%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.3.</span> <span class="toc-text">Activity 和 Service 进行通信</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.4.</span> <span class="toc-text">Service 的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service-%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%8A%80%E5%B7%A7"><span class="toc-number">1.5.</span> <span class="toc-text">Service 的更多技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%89%8D%E5%8F%B0-Service"><span class="toc-number">1.5.1.</span> <span class="toc-text">使用前台 Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-IntentService"><span class="toc-number">1.5.2.</span> <span class="toc-text">使用 IntentService</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kotlin-%E8%AF%BE%E5%A0%82%EF%BC%9A%E6%B3%9B%E5%9E%8B%E7%9A%84%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.6.</span> <span class="toc-text">Kotlin 课堂：泛型的高级特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%B3%9B%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%AE%9E%E5%8C%96"><span class="toc-number">1.6.1.</span> <span class="toc-text">对泛型进行实化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E5%AE%9E%E5%8C%96%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.2.</span> <span class="toc-text">泛型实化的应用</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/24/findViewById%E7%94%A8%E6%B3%95%E8%AF%A6%E8%A7%A3/" title="findViewById用法详解">findViewById用法详解</a><time datetime="2025-04-24T14:07:36.000Z" title="Created 2025-04-24 22:07:36">2025-04-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/22/%E5%B9%B3%E7%A7%BB%E5%8A%A8%E7%94%BB%E8%AF%A6%E8%A7%A3/" title="平移动画详解">平移动画详解</a><time datetime="2025-04-22T12:10:30.000Z" title="Created 2025-04-22 20:10:30">2025-04-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/22/ConstrainLayout%E7%94%A8%E6%B3%95%E8%AF%A6%E8%A7%A3/" title="ConstrainLayout用法详解">ConstrainLayout用法详解</a><time datetime="2025-04-22T11:20:48.000Z" title="Created 2025-04-22 19:20:48">2025-04-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/10/32%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E5%85%A8%E6%94%BB%E7%95%A5/" title="32汇编语言入门全攻略">32汇编语言入门全攻略</a><time datetime="2025-04-10T14:47:13.000Z" title="Created 2025-04-10 22:47:13">2025-04-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/10/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%98-%E9%80%82%E7%94%A8%E4%BA%8E-MASM-Irvine32/" title="汇编语言入门与实战(适用于 MASM + Irvine32)">汇编语言入门与实战(适用于 MASM + Irvine32)</a><time datetime="2025-04-10T14:37:18.000Z" title="Created 2025-04-10 22:37:18">2025-04-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By GoshenC</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="100" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>